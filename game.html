<!doctype html>
<html>
  <head>
    <style>
      canvas.padding{
        padding-left: 560px;
        padding-top: 150px;
      }
      h2.padding{
        padding-left: 700px;
      }
      button.padding{
        position: absolute;
        top: 720px;
        left: 790px;
      }
      h1.padding{
        position: absolute;
        padding-left: 730px;
        padding-top: 10px;
      }
    </style>
  </head>
  <body bgcolor="#2ECCFA">
    <canvas id="testCanvas" width = "500" height = "500"; class = "padding"></canvas>
    <h2 id="title" class = "padding"></h2>
    <h1 id="gameFinal" class = "padding"></p>
  	<script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"> </script>
    <script>
      function reset(grid){
        var canvas = document.getElementById("testCanvas");
        var context = canvas.getContext("2d");
        context.fillStyle = "white";
        context.moveTo(0,0);
        context.beginPath();
        context.rect(0,0,500,500);
        context.fill();
        context.moveTo(167,0);
        context.lineTo(167,500);
        context.stroke();
        context.moveTo(334,0);
        context.lineTo(334,500);
        context.stroke();
        context.moveTo(0,167);
        context.lineTo(500,167);
        context.stroke();
        context.moveTo(0,334);
        context.lineTo(500, 334);
        context.stroke();
        for(var i = 0; i<3; i++){
          for(var j = 0; j<3; j++){
            grid[i][j] = 0;
          }
        }
        document.getElementById("gameFinal").innerHTML = "";
      }
      function checkColor(grid, x, y){
        if(grid[x][y]!=0){
          return true;
        }
        else{
          return false;
        }
      }
      function check(grid){
        var done = false;
        if(grid[0][0]===1 && grid[0][1]===1 && grid[0][2]===1){
          document.getElementById("gameFinal").innerHTML = "Blue Won!";
          done = true;
        }
        else if(grid[0][0]===2 && grid[0][1]===2 && grid[0][2]===2){
          document.getElementById("gameFinal").innerHTML = "Red Won!";
          done = true;
        }
        else if(grid[1][0]===1 && grid[1][1]===1 && grid[1][2]===1){
          document.getElementById("gameFinal").innerHTML = "Blue Won!";
          done = true;
        }
        else if(grid[1][0]===2 && grid[1][1]===2 && grid[1][2]===2){
          document.getElementById("gameFinal").innerHTML = "Red Won!";
          done = true;
        }
        else if(grid[2][0]===1 && grid[2][1]===1 && grid[2][2]===1){
          document.getElementById("gameFinal").innerHTML = "Blue Won!";
          done = true;
        }
        else if(grid[2][0]===2 && grid[2][1]===2 && grid[2][2]===2){
          document.getElementById("gameFinal").innerHTML = "Red Won!";
          done = true;
        }
        else if(grid[0][0]===1 && grid[1][0]===1 && grid[2][0]===1){
          document.getElementById("gameFinal").innerHTML = "Blue Won!";
          done = true;
        }
        else if(grid[0][0]===2 && grid[1][0]===2 && grid[2][0]===2){
          document.getElementById("gameFinal").innerHTML = "Red Won!";
          done = true;
        }
        else if(grid[0][1]===1 && grid[1][1]===1 && grid[2][1]===1){
          document.getElementById("gameFinal").innerHTML = "Blue Won!";
          done = true;
        }
        else if(grid[0][1]===2 && grid[1][1]===2 && grid[2][1]===2){
          document.getElementById("gameFinal").innerHTML = "Red Won!";
          done = true;
        }
        else if(grid[0][2]===1 && grid[1][2]===1 && grid[2][2]===1){
          document.getElementById("gameFinal").innerHTML = "Blue Won!";
          done = true;
        }
        else if(grid[0][2]===2 && grid[1][2]===2 && grid[2][2]===2){
          document.getElementById("gameFinal").innerHTML = "Red Won!";
          done = true;
        }
        else if(grid[0][0]===1 && grid[1][1]===1 && grid[2][2]===1){
          document.getElementById("gameFinal").innerHTML = "Blue Won!";
          done = true;
        }
        else if(grid[0][0]===2 && grid[1][1]===2 && grid[2][2]===2){
          document.getElementById("gameFinal").innerHTML = "Red Won!";
          done = true;
        }
        else if(grid[0][2]===1 && grid[1][1]===1 && grid[2][0]===1){
          document.getElementById("gameFinal").innerHTML = "Blue Won!";
          done = true;
        }
        else if(grid[0][2]===2 && grid[1][1]===2 && grid[2][0]===2){
          document.getElementById("gameFinal").innerHTML = "Red Won!";
          done = true;
        }
        if(done){
          setTimeout(function(){
            reset(grid);
          },(2000));
        }
        else{
          for(var i = 0; i<3; i++){
            for(var j = 0; j<3; j++){
              if(grid[i][j]===0){
                return;
              }
            }
          }
          document.getElementById("gameFinal").innerHTML = "Cat's Game!";
          setTimeout(function(){
           reset(grid);
          },(2000));
        }
      };
      //1 is red
      //2 is blue
      //0 is unclaimed
      var grid = [[000],[000],[000]];
      var colors = ["red", "blue"];
      var count = 0;
      var mouse = function(e){
        var x = e.x;
        var y = e.y;
        //window.alert(x + " ," + y);
        var canvas = document.getElementById("testCanvas");
        x -= canvas.offsetLeft;
        y -= canvas.offsetTop;
        var context = canvas.getContext("2d");
        context.fillStyle = colors[count%2];
        count++;
        if(count>100)
        {
          count = 0;
        }
        if(x<=727){
          if(y<=317){
            //window.alert("0,0");
            if(checkColor(grid, 0, 0)){
              count--;
              return;
            }
            context.beginPath();
            context.rect(0,0,166,166);
            context.fill();
            if(colors[count%2] == "red"){
             grid[0][0] = 1;
            }
            else{
              grid[0][0] = 2;
            }
            check(grid);
            return;
          }
          else if(y<=484){
            //window.alert("0,1");
            if(checkColor(grid, 0, 1)){
              count--;
              return;
            }
            context.beginPath();
            context.rect(0,168,166,166);
            context.fill();
            if(colors[count%2] == "red"){
             grid[0][1] = 1;
            }
            else{
              grid[0][1] = 2;
            }
            check(grid);
            return;
          }
          else{
            //window.alert("0,2");
            if(checkColor(grid, 0, 2)){
              count--;
              return;
            }
            context.beginPath();
            context.rect(0,335,166,166);
            context.fill();
            if(colors[count%2] == "red"){
             grid[0][2] = 1;
            }
            else{
              grid[0][2] = 2;
            }
            check(grid);
            return;
          }
        }
        else if(x<=894){
          if(y<=317){
            if(checkColor(grid, 1, 0)){
              count--;
              return;
            }
            //window.alert("1,0");
            context.beginPath();
            context.rect(168,0,166,166);
            context.fill();
            if(colors[count%2] == "red"){
             grid[1][0] = 1;
            }
            else{
              grid[1][0] = 2;
            }
            check(grid);
            return;
          }
          else if(y<=484){
            if(checkColor(grid, 1, 1)){
              count--;
              return;
            }
            //window.alert("1,1");
            context.beginPath();
            context.rect(168,168,166,166);
            context.fill();
            if(colors[count%2] == "red"){
             grid[1][1] = 1;
            }
            else{
              grid[1][1] = 2;
            }
            check(grid);
            return;
          }
          else{
            if(checkColor(grid, 1, 2)){
              count--;
              return;
            }
            //window.alert("1,2");
            context.beginPath();
            context.rect(168,335,166,166);
            context.fill();
            if(colors[count%2] == "red"){
             grid[1][2] = 1;
            }
            else{
              grid[1][2] = 2;
            }
            check(grid);
            return;
          }
        }
        else{
          if(y<=317){
            if(checkColor(grid, 2, 0)){
              count--;
              return;
            }
            //window.alert("2,0");
            context.beginPath();
            context.rect(335,0,166,166);
            context.fill();
            if(colors[count%2] == "red"){
             grid[2][0] = 1;
            }
            else{
              grid[2][0] = 2;
            }
            check(grid);
            return;
          }
          else if(y<=484){
            if(checkColor(grid, 2, 1)){
              count--;
              return;
            }
            //window.alert("2,1");
            context.beginPath();
            context.rect(335,168,166,166);
            context.fill();
            if(colors[count%2] == "red"){
             grid[2][1] = 1;
            }
            else{
              grid[2][1] = 2;
            }
            check(grid);
            return;
          }
          else{
            if(checkColor(grid, 2, 2)){
              count--;
              return;
            }
            //window.alert("2,2");
            context.beginPath();
            context.rect(335,335,166,166);
            context.fill();
            if(colors[count%2] == "red"){
             grid[2][2] = 1;
            }
            else{
              grid[2][2] = 2;
            }
            check(grid);
            return;
          }
        }
      }
      var socket = io();
      reset(grid);
      var canvas = document.getElementById("testCanvas");
      canvas.addEventListener("mousedown", mouse, false);
      socket.on('tictactoeLoad', function(name){
        window.alert("BLAH");
        document.getElementById('title').innerHTML = name + "'s Tic-Tac-Toe Game";
      });
  	</script>
  </body>
</html>
